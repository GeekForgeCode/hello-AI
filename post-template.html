<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { background: #0a0a0f; color: #d1d5db; font-family: sans-serif; line-height: 1.8; padding: 40px; margin: 0; }
        .content-header { border-bottom: 1px solid #333; margin-bottom: 30px; padding-bottom: 10px; }
        .content-header h1 { color: #fff; margin: 0; font-size: 2rem; }
        
        /* 这里的样式模仿你图3中的内容排版 */
        #md-render h2 { color: #fff; border-left: 4px solid #00f3ff; padding-left: 15px; margin-top: 40px; }
        #md-render p { font-size: 1.05rem; color: #9ca3af; }
        
        /* Python 实验室逻辑 */
        .lab-section { background: #000; border: 1px solid #00f3ff; margin-top: 50px; border-radius: 4px; overflow: hidden; }
        .lab-title { background: #111; padding: 10px; font-size: 0.8rem; color: #00f3ff; border-bottom: 1px solid #222; }
        #py-output { padding: 15px; color: #4ade80; font-family: monospace; background: #050505; white-space: pre-wrap; }
        .run-btn { width: 100%; padding: 10px; background: #00f3ff; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="content-header">
        <div id="post-date" style="font-size: 0.8rem; color: #666;">2025年12月24日</div>
        <h1 id="post-title">载入中...</h1>
    </div>

    <div id="md-render">读取文档指令中...</div>

    <div class="lab-section">
        <div class="lab-title">LIVE_CODE_LAB (PYTHON)</div>
        <textarea id="code-editor" style="width:100%; height:100px; background:#000; color:#fff; border:none; padding:15px; outline:none;">print("Transformer Attention 权重测试...")</textarea>
        <button class="run-btn" onclick="runCode()">运行代码 (EXECUTE)</button>
        <div id="py-output">等待执行...</div>
    </div>

    <script>
        // 获取参数并渲染
        const params = new URLSearchParams(window.location.search);
        const mdPath = params.get('md') || 'posts/ai/transformer.md';

        fetch(mdPath).then(res => res.text()).then(md => {
            document.getElementById('md-render').innerHTML = marked.parse(md);
            // 触发 MathJax 渲染公式
            if(window.MathJax) MathJax.typeset();
            // 获取第一行标题作为页面标题
            const firstLine = md.split('\n')[0].replace('# ', '');
            document.getElementById('post-title').innerText = firstLine;
        });

        // Python 引擎逻辑
        let pyodide;
        async function runCode() {
            if(!pyodide) pyodide = await loadPyodide();
            const code = document.getElementById('code-editor').value;
            try {
                pyodide.runPython(`import sys, io; sys.stdout = io.StringIO()`);
                await pyodide.runPythonAsync(code);
                document.getElementById('py-output').innerText = pyodide.runPython("sys.stdout.getvalue()");
            } catch(e) { document.getElementById('py-output').innerText = e; }
        }
    </script>
</body>
</html>
